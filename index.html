<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4169E1">
    <title>Bulldog Builder</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí™</text></svg>">
    <link rel="manifest" href="manifest.json" onerror="this.remove()">
    <link rel="stylesheet" href="styles.css">
    <link rel="apple-touch-icon" href="icon-192.png" onerror="this.remove()">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Firebase SDKs (only loads if not file:// protocol) -->
    <script>
        if (window.location.protocol !== 'file:') {
            const script1 = document.createElement('script');
            script1.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js';
            
            script1.onload = () => {
                const script2 = document.createElement('script');
                script2.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js';
                
                script2.onload = () => {
                    const configScript = document.createElement('script');
                    configScript.src = 'firebase-config.js';
                    document.head.appendChild(configScript);
                };
                document.head.appendChild(script2);
            };
            document.head.appendChild(script1);
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div style="flex: 1; display: flex; align-items: center; gap: 15px;">
                    <select id="classFilterSelect" class="form-control" style="padding: 8px 16px; font-size: 14px; font-weight: 600; width: auto; min-width: 120px; background: rgba(255, 255, 255, 0.15); color: white; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 8px; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s;">
                        <option value="" style="background: var(--card-bg); color: var(--text-primary);">Loading...</option>
                    </select>
                    <div style="flex: 1;">
                        <h1>üí™ Bulldog Builder</h1>
                        <p class="subtitle">Weight Lifting Tracker</p>
                    </div>
                </div>
                <button id="genderToggleBtn" class="btn btn-secondary" style="padding: 10px 20px; font-size: 14px; font-weight: 600; white-space: nowrap; margin-left: 20px;">Go to Girls</button>
            </div>
            <div id="syncStatus" style="margin-top: 10px; font-size: 14px; color: white; text-align: center; font-weight: 500; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);"></div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="athletes">üë• Athletes</button>
            <button class="tab-btn" data-tab="weighIns">üìä Weigh Ins</button>
            <button class="tab-btn" data-tab="progress">üìà Progress</button>
        </div>

        <!-- Athletes Tab -->
        <div class="tab-content active" id="athletesTab">
            <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: center;">
                <input type="text" id="athleteSearchInput" class="form-control" placeholder="üîç Search athletes..." style="flex: 1;">
                <button class="btn btn-primary" id="addAthleteBtn" style="padding: 10px 16px; font-size: 14px; white-space: nowrap;">‚ûï Add</button>
            </div>
            <div class="athletes-list" id="athletesList" style="display: none;">
                <!-- Athletes will be dynamically added here -->
            </div>
            <div class="empty-state" id="emptyAthletesState" style="display: none;">
                <p>üîç No athletes found</p>
                <p>Try a different search term</p>
            </div>
        </div>

        <!-- Weigh Ins Tab -->
        <div class="tab-content" id="weighInsTab">
            <!-- Period Sub-Tabs -->
            <div class="period-tabs" id="periodTabs" style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; overflow-x: auto;">
                <!-- Period tabs will be dynamically added here -->
            </div>
            
            <div id="weighInPeriodContent">
                <div class="weigh-ins-list" id="weighInsList">
                    <!-- All players' weigh in information will be displayed here -->
                </div>
            </div>
            <div class="empty-state" id="emptyWeighInState" style="display: none;">
                <p>üìä No data to display.</p>
                <p>Select a period to view all players' information.</p>
            </div>
        </div>

        <!-- Progress Tab -->
        <div class="tab-content" id="progressTab">
            <div class="progress-header" style="margin-bottom: 15px;">
                <label for="progressAthleteSelect" style="display: block; margin-bottom: 8px; font-weight: 600;">Select Athlete:</label>
                <select id="progressAthleteSelect" class="form-control" style="width: 100%; margin-bottom: 15px;">
                    <option value="">-- Select Athlete --</option>
                </select>
            </div>
            <div class="empty-state" id="emptyProgressState" style="display: block;">
                <p>üìà Select an athlete to view progress!</p>
            </div>
        </div>
    </div>

    <!-- Add/Edit Athlete Modal -->
    <div class="modal" id="athleteModal">
        <div class="modal-content">
            <span class="close" id="closeAthleteModal">&times;</span>
            <h2 id="athleteModalTitle">Add Athlete</h2>
            <form id="athleteForm">
                <div class="form-group">
                    <label for="athleteNameInput">Name:</label>
                    <input type="text" id="athleteNameInput" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="athleteClassOfInput">Class of (optional):</label>
                    <select id="athleteClassOfInput" class="form-control">
                        <option value="">-- Select Year --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="athleteGenderInput">Gender:</label>
                    <select id="athleteGenderInput" class="form-control" required>
                        <option value="">-- Select Gender --</option>
                        <option value="Boy">Boy</option>
                        <option value="Girl">Girl</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save Athlete</button>
            </form>
            <button id="deleteAthleteBtn" class="btn btn-danger" style="width: 100%; margin-top: 10px; display: none;">Delete Athlete</button>
        </div>
    </div>

    <!-- Athlete Profile Modal -->
    <div class="modal" id="athleteProfileModal">
        <div class="modal-content" style="max-height: 90vh;">
            <span class="close" id="closeAthleteProfileModal">&times;</span>
            <div id="athleteProfileHeader" style="padding: 20px; border-bottom: 2px solid var(--border-color);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                    <h2 id="athleteProfileName" style="margin: 0; color: var(--text-primary);"></h2>
                    <button class="edit-athlete-icon-btn" id="editAthleteFromProfileBtn" style="background: none; border: none; cursor: pointer; padding: 4px 6px; opacity: 0.6; transition: opacity 0.3s;" title="Edit Athlete">‚úèÔ∏è</button>
                </div>
                <div id="athleteProfileClass" style="color: var(--text-secondary); font-size: 16px;"></div>
            </div>
            <div style="padding: 20px;">
                <!-- Period Tabs for Profile -->
                <div class="period-tabs" id="athleteProfilePeriodTabs" style="margin-bottom: 20px;">
                    <!-- Period tabs will be dynamically added here -->
                </div>
                
                <!-- Lift/Run Inputs for Selected Period -->
                <form id="athleteLiftsForm">
                    <div class="lifts-container" id="athleteLiftsContainer">
                        <!-- Lift inputs will be dynamically added here -->
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Save Lifts & Runs</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Period Modal -->
    <div class="modal" id="periodModal">
        <div class="modal-content">
            <span class="close" id="closePeriodModal">&times;</span>
            <h2 id="periodModalTitle">Add Period</h2>
            <form id="periodForm">
                <div class="form-group">
                    <label for="periodNameInput">Period Name:</label>
                    <input type="text" id="periodNameInput" class="form-control" placeholder="e.g., Fall 2024, Spring 2025" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save Period</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit Weigh In Modal -->
    <div class="modal" id="weighInModal">
        <div class="modal-content">
            <span class="close" id="closeWeighInModal">&times;</span>
            <h2 id="weighInModalTitle">Add Weigh In</h2>
            <form id="weighInForm">
                <div class="form-group">
                    <label for="weighInAthleteSelect">Athlete:</label>
                    <select id="weighInAthleteSelect" class="form-control" required>
                        <option value="">-- Select Athlete --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="weighInDateInput">Date:</label>
                    <input type="date" id="weighInDateInput" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="weighInNotesInput">Notes (optional):</label>
                    <textarea id="weighInNotesInput" class="form-control" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Exercises:</label>
                    <div id="exercisesContainer">
                        <!-- Exercises will be dynamically added here -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="addExerciseBtn" style="margin-top: 10px; width: 100%;">‚ûï Add Exercise</button>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save Weigh In</button>
            </form>
        </div>
    </div>

    <!-- Progress Graphs Modal -->
    <div class="modal" id="progressModal">
        <div class="modal-content" style="max-width: 95%; max-height: 95vh; overflow-y: auto;">
            <span class="close" id="closeProgressModal">&times;</span>
            <h2 id="progressModalTitle" style="margin-bottom: 20px;">Progress Charts</h2>
            <div class="progress-graphs-container">
                <div class="progress-graph-card">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary); font-size: 20px; font-weight: 600;">Weight Lifts Progress</h3>
                    <canvas id="liftsChart"></canvas>
                    <div id="weightLiftsTable" style="margin-top: 15px; overflow-x: auto;">
                        <!-- Weight lifts table will be dynamically added here -->
                    </div>
                </div>
                <div class="progress-graph-card">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary); font-size: 20px; font-weight: 600;">Lift Rating Progress</h3>
                    <canvas id="ratingChart"></canvas>
                </div>
                <div class="progress-graph-card">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary); font-size: 20px; font-weight: 600;">Running Exercises Progress</h3>
                    <canvas id="runsChart"></canvas>
                    <div id="runsTable" style="margin-top: 15px; overflow-x: auto;">
                        <!-- Runs table will be dynamically added here -->
                    </div>
                </div>
                <div class="progress-graph-card">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary); font-size: 20px; font-weight: 600;">Vertical (VERT) Progress</h3>
                    <canvas id="vertChart"></canvas>
                    <div id="vertTable" style="margin-top: 15px; overflow-x: auto;">
                        <!-- Vertical table will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>

